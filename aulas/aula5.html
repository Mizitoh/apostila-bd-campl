<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aula 5 - PK, FK e Leitura de dados</title>
    <link rel="icon" type="image/png" href="./../assets/imagens/caderno.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./../assets/css/style.css" />
  </head>
  <body>
    <div class="container">
      <main class="content">
        <h1>Aula 5 - PK, FK e Padroniza√ß√£o do banco de dados "Escola"</h1>

        <h2>Chaves Prim√°rias (Primary Keys - PK)</h2>
        <p>
          Uma chave prim√°ria (PK) √© um identificador √∫nico para cada registro em
          uma tabela. No nosso modelo:
        </p>
        <ul>
          <li>Cada tabela possui sua pr√≥pria PK chamada <code>id</code></li>
          <li>S√£o valores √∫nicos e n√£o podem ser nulos</li>
          <li>Geralmente s√£o n√∫meros inteiros auto incrementais</li>
        </ul>

        <hr />

        <h2>Chaves Estrangeiras (Foreign Keys - FK)</h2>
        <p>
          Chaves estrangeiras (FK) estabelecem relacionamentos entre tabelas. Em
          nosso modelo temos:
        </p>
        <ul>
          <li>
            <code>aluno_id</code> em ENDERE√áOS - liga cada endere√ßo a um aluno
          </li>
          <li>
            <code>aluno_id</code> em TELEFONES - associa telefones aos alunos
          </li>
          <li>
            <code>aluno_id</code> e <code>curso_id</code> em MATR√çCULAS -
            conecta alunos aos cursos
          </li>
        </ul>

        <hr />

        <h2>Constraints (Restri√ß√µes)</h2>
        <p>Principais constraints utilizadas:</p>
        <pre><code class="language-sql">
-- NOT NULL: Campo n√£o pode ser vazio
nome VARCHAR(100) NOT NULL,
email VARCHAR(100) NOT NULL,

-- UNIQUE: Valor deve ser √∫nico na tabela
email VARCHAR(100) NOT NULL UNIQUE,

-- CHECK: Valida valores permitidos
status VARCHAR(20) CHECK (status IN ('Ativo','Inativo','Trancado')),

-- DEFAULT: Define valor padr√£o
data_cadastro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        </code></pre>

        <hr />

        <h2>Finaliza√ß√£o do MER</h2>

        <p>
          Embora n√£o foi dito em aula, toda parte de modela√ß√£o/arquitetura que
          fizemos √© chamado de MER (Modelo Entidade-Relacionamento)
        </p>
        <p>
          O MER √© uma representa√ß√£o gr√°fica que descreve a estrutura l√≥gica do
          banco de dados, incluindo entidades, atributos e relacionamentos.
        </p>
        <p>Uma entidade seria uma tabela, nossa tabela "aluno", por exemplo</p>
        <p>Um atributo seria uma coluna, como "nome" na tabela aluno</p>
        <p>
          E um relacionamento seria a liga√ß√£o entre tabelas, como a FK
          "aluno_id" na tabela endere√ßos
        </p>
        <p>A nota√ß√£o que liga essas tabelas s√£o:</p>
        <ul>
          <li>Linha reta: representa um relacionamento "um para um" (1:1)</li>
          <li>
            Linha com p√© de galinha: representa um relacionamento "um para
            muitos" (1:N)
          </li>
          <li>
            Linha com dois p√©s de galinha: representa um relacionamento "muitos
            para muitos" (N:N)
          </li>
        </ul>

        <div class="image-wrapper">
          <img
            src="./../assets/imagens/pedegalinha.png"
            alt="MER p√© de galinha"
          />
        </div>

        <p>
          Na aula s√≥ vimos a nota√ß√£o <strong>P√© de Galinha</strong> (do ingl√™s,
          Crow's Foot Notation), mas existem outras:
        </p>
        <ul>
          <li>
            <strong>Nota√ß√£o de Chen:</strong> Usa ret√¢ngulos para entidades,
            elipses para atributos e losangos para relacionamentos.
            <div class="image-wrapper">
              <img
                src="./../assets/imagens/notacaopeterchen.png"
                alt="Nota√ß√£o de Peter Chen"
              />
            </div>
          </li>
          <li>
            <strong>Nota√ß√£o de barker:</strong> Este estilo √© uma varia√ß√£o da
            nota√ß√£o P√© de Galinha, popularizada por seu uso pela Oracle. Linhas
            cont√≠nuas: Para relacionamentos obrigat√≥rios. Pontilhadas: Para
            relacionamentos opcionais. Cardinalidade: Usa s√≠mbolos semelhantes
            ao P√© de Galinha (tra√ßos, c√≠rculos e o s√≠mbolo de p√© de galinha),
            mas sua representa√ß√£o visual pode ser mais integrada ao estilo da
            ferramenta.
            <div class="image-wrapper">
              <img
                src="./../assets/imagens/barker.jpg"
                alt="Nota√ß√£o de Barker"
              />
            </div>
          </li>
          <li>
            <strong>Nota√ß√£o UML (Unified Modeling Language):</strong> Utiliza
            classes e associa√ß√µes, sendo mais comum em modelagem orientada a
            objetos.
            <div class="image-wrapper">
              <img src="./../assets/imagens/uml.png" alt="Nota√ß√£o UML" />
            </div>
          </li>
        </ul>

        <div class="alert alert-info mt-4" role="alert">
          üí° <strong>Orienta√ß√£o a Objeto</strong>
          ser√° tratado nas aulas de JAVA, n√£o se prenda a isso agora.
        </div>

        <hr />

        <h2>Padronizando o nosso banco</h2>
        <p>
          At√© agora n√≥s criamos e deletamos tabelas constantemente para entender
          os conceitos.
        </p>
        <p>
          Agora vamos padronizar o nosso banco de dados "Escola", criando todas
          as tabelas com suas chaves prim√°rias, estrangeiras e constraints.
        </p>

        <p>
          Vamos inserir dados, atualizar e na proxima aula aprofundar nas
          consultas de dados.
        </p>

        <h2>Script completo do banco "escola"</h2>

        <pre><code class="language-sql">
-- Cria√ß√£o do banco de dados
-- ========================================
-- CRIANDO AS TABELAS
-- ========================================

-- 1. TABELA DE SEXOS (inclus√£o e diversidade)
CREATE TABLE sexos (
    id SERIAL PRIMARY KEY,
    codigo CHAR(1) UNIQUE NOT NULL,
    descricao VARCHAR(20) NOT NULL,
    pronome VARCHAR(10)
);

-- 2. TABELA DE ALUNOS (dados principais)
CREATE TABLE alunos (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    sexo_id INT NOT NULL,
    cpf varchar(14) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (sexo_id) REFERENCES sexos(id) ON DELETE RESTRICT
);

-- 3. TABELA DE ENDERE√áOS
CREATE TABLE enderecos (
    id SERIAL PRIMARY KEY,
    id_aluno INT NOT NULL,
    rua VARCHAR(200) NOT null,
    numero int8,
    bairro VARCHAR(200),
    cidade VARCHAR(200),
    complemento TEXT
);

-- Adicionando constraint de FK na tabela endere√ßos
ALTER TABLE enderecos
ADD CONSTRAINT fk_aluno
FOREIGN KEY (id_aluno)
REFERENCES alunos (id)
ON DELETE CASCADE
ON UPDATE CASCADE;

-- 4. TABELA DE TELEFONES
CREATE TABLE telefones (
    id SERIAL PRIMARY KEY,
    id_aluno INT NOT NULL,
    numero VARCHAR(15) NOT NULL,
    FOREIGN KEY (id_aluno) REFERENCES alunos(id) ON DELETE CASCADE
);

-- 5. TABELA DE PROFESSORES
CREATE TABLE professores (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL UNIQUE
);

-- 6. TABELA DE CURSOS
CREATE TABLE cursos (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(50) NOT NULL UNIQUE,
    professor_id INT NOT NULL,
    FOREIGN KEY (professor_id) REFERENCES professores(id) ON DELETE RESTRICT
);

-- 7. TABELA DE MATR√çCULAS (relacionamento N para N entre alunos e cursos)
CREATE TABLE matriculas (
    id SERIAL PRIMARY KEY,
    matricula_id_aluno INT NOT NULL,
    curso_id INT NOT NULL,
    nota DECIMAL(4,2),
    data_matricula DATE DEFAULT CURRENT_DATE,
    FOREIGN KEY (matricula_id_aluno) REFERENCES alunos(id) ON DELETE CASCADE,
    FOREIGN KEY (curso_id) REFERENCES cursos(id) ON DELETE CASCADE,
    UNIQUE(matricula_id_aluno, curso_id) -- Evita matr√≠cula duplicada no mesmo curso
);

-- ========================================
-- INSERINDO OS DADOS
-- ========================================

-- Passo 1: Inserir Sexos (inclus√£o e diversidade)
INSERT INTO sexos (codigo, descricao, pronome) VALUES
('M', 'Masculino', 'ele/dele'),
('F', 'Feminino', 'ela/dela'),
('N', 'N√£o-bin√°rio', 'elu/delu'),
('O', 'Outro', 'elu/delu'),
('P', 'Prefiro n√£o dizer', NULL);

-- Passo 2: Inserir Professores
INSERT INTO professores (nome) VALUES
('Prof. Carlos Eduardo'),
('Profa. Juliana Santos');

-- Passo 3: Inserir Cursos (com os professores)
INSERT INTO cursos (nome, professor_id) VALUES
('PostgreSQL Essencial', 1),  -- Professor Carlos Eduardo (id 1)
('Python para Dados', 2);     -- Professora Juliana Santos (id 2)

-- Passo 4: Inserir Alunos (agora com sexo_id)
INSERT INTO alunos (nome, sexo_id, cpf) VALUES
('Alice Silva', 2, '12345678911'),      -- Feminino
('Bruno Mendes', 1, '12345678912'),     -- Masculino
('Sam Oliveira', 3, '12345678913'),     -- N√£o-bin√°rio
('Jordan Santos', 5, '12345678914'),    -- Prefiro n√£o dizer
('Taylor Lima', 3, '12345678915');      -- N√£o-bin√°rio

-- Passo 5: Inserir Endere√ßos
INSERT INTO enderecos (id_aluno, rua, numero, bairro, cidade, complemento) VALUES
(1, 'Rua das Flores', 150, 'Centro', 'S√£o Paulo', ''),
(2, 'Av. Central', 500, 'Ipanema', 'Rio de Janeiro', null),
(3, 'Rua Augusta', 200, 'Vila Queiroz', 'Limeira', null),
(4, 'Av. Paulista', 1000, 'Werner Plaz', 'Americana', ''),
(5, 'Rua Oscar Freire', null, 'Fim de Mundo', 'Santa B√°rbara D Oeste', 'fim de mundo n√£o tem numero');

-- Passo 6: Inserir Telefones
INSERT INTO telefones (id_aluno, numero) VALUES
(1, '(11) 98765-4321'),
(1, '(11) 3333-2222'),  -- Alice tem 2 telefones
(2, '(21) 99999-1111'),
(3, '(11) 97777-5555'),
(3, '(11) 96666-4444'),
(4, '(11) 95555-3333'),
(5, '(11) 94444-2222'),
(5, '(11) 93333-1111'),
(5, '(11) 92222-0000'); -- Taylor tem 3 telefones

-- Passo 7: Inserir Matr√≠culas (com notas)
INSERT INTO matriculas (matricula_id_aluno, curso_id, nota) VALUES
(1, 1, 9.50),  -- Alice em PostgreSQL
(1, 2, 8.80),  -- Alice em Python
(2, 1, 7.00),  -- Bruno em PostgreSQL
(3, 2, 9.20),  -- Sam em Python
(4, 1, 8.50),  -- Jordan em PostgreSQL
(4, 2, 7.80),  -- Jordan em Python
(5, 1, 9.00);  -- Taylor em PostgreSQL

        </code></pre>

        <hr />

        <h2>Menu</h2>
        <div class="mt-4">
          <a href="./aula6.html" class="btn btn-primary">Pr√≥xima aula ‚Üí</a>
          <a href="./../index.html" class="btn btn-outline-secondary"
            >‚Üê Voltar ao In√≠cio</a
          >
          <a href="./../aulas.html" class="btn btn-outline-secondary"
            >‚Üê Voltar √†s aulas por data</a
          >
        </div>
      </main>
    </div>

    <script src="./../assets/js/sidebar.js"></script>
    <script src="./../assets/js/table-of-contents.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
  </body>
</html>
