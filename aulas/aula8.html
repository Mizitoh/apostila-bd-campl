<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aula 8 - C√°lculos e manipula√ß√£o de string</title>
    <link rel="icon" type="image/png" href="./../assets/imagens/caderno.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./../assets/css/style.css" />
  </head>
  <body>
    <div class="container">
      <main class="content">
        <h1>Aula 8 - DELETE, TRUNCATE e Backups</h1>

        <h2>DELETE - Removendo registros espec√≠ficos</h2>
        <p>
          O comando <code>DELETE</code> remove registros espec√≠ficos de uma
          tabela. Diferente do <code>TRUNCATE</code>, ele permite usar a
          cl√°usula <code>WHERE</code> para remover apenas registros que atendem
          a certas condi√ß√µes.
        </p>

        <h3>Sintaxe b√°sica</h3>
        <pre><code class="language-sql">
DELETE FROM nome_tabela
WHERE condi√ß√£o;
        </code></pre>

        <h3>Exemplos pr√°ticos</h3>
        <pre><code class="language-sql">
-- Exemplo 1: Remover um aluno espec√≠fico
DELETE FROM alunos
WHERE id = 5;

-- Exemplo 2: Remover alunos de um determinado sexo
DELETE FROM alunos
WHERE sexo_id = 3;

-- Exemplo 3: Remover matr√≠culas com nota menor que 7
DELETE FROM matriculas
WHERE nota < 7;

-- Exemplo 4: Remover telefones de um aluno espec√≠fico
DELETE FROM telefones
WHERE id_aluno = 2;

-- CUIDADO! Sem WHERE, deleta todos os registros
DELETE FROM alunos; -- Isso vai deletar TODOS os alunos!

-- Melhor pr√°tica: Usar DELETE com WHERE e ser espec√≠fico
DELETE FROM enderecos
WHERE id_aluno = 1 AND cidade = 'S√£o Paulo';
        </code></pre>

        <div class="alert alert-warning mt-3" role="alert">
          ‚ö†Ô∏è <strong>Cuidado!</strong> DELETE sem WHERE √© perigoso. Sempre
          especifique a condi√ß√£o para remover apenas o que √© necess√°rio. Se usar
          DELETE sem WHERE, todos os registros ser√£o removidos!
        </div>

        <hr />

        <h2>TRUNCATE - Removendo todos os registros rapidamente</h2>
        <p>
          O comando <code>TRUNCATE</code> remove <strong>todos</strong> os
          registros de uma tabela rapidamente. √â muito mais r√°pido que DELETE
          quando voc√™ quer esvaziar a tabela completamente.
        </p>

        <h3>Diferen√ßas principais entre DELETE e TRUNCATE</h3>
        <table class="table table-bordered mt-3">
          <thead>
            <tr>
              <th>Aspecto</th>
              <th>DELETE</th>
              <th>TRUNCATE</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Cl√°usula WHERE</td>
              <td>‚úÖ Usa WHERE para registros espec√≠ficos</td>
              <td>‚ùå Remove todos sempre</td>
            </tr>
            <tr>
              <td>Velocidade</td>
              <td>Mais lento</td>
              <td>Muito mais r√°pido</td>
            </tr>
            <tr>
              <td>Triggers</td>
              <td>Ativa triggers</td>
              <td>N√£o ativa triggers</td>
            </tr>
            <tr>
              <td>Auto-increment</td>
              <td>Mant√©m o contador</td>
              <td>Reseta o contador (depende do SGBD)</td>
            </tr>
          </tbody>
        </table>

        <h3>Sintaxe e exemplos</h3>
        <pre><code class="language-sql">
-- Sintaxe
TRUNCATE TABLE nome_tabela;

-- Exemplo 1: Esvaziar a tabela de matr√≠culas
TRUNCATE TABLE matriculas;

-- Exemplo 2: Esvaziar a tabela de endere√ßos
TRUNCATE TABLE enderecos;

-- Exemplo 3: Esvaziar a tabela de telefones
TRUNCATE TABLE telefones;

-- O TRUNCATE √© muito √∫til para:
-- - Limpar dados de teste depois de testes
-- - Resetar uma tabela rapidamente
-- - Remover dados sem logar cada remo√ß√£o individual
        </code></pre>

        <div class="alert alert-danger mt-3" role="alert">
          üî¥ <strong>Aten√ß√£o!</strong> TRUNCATE remove TODOS os registros e
          <strong>n√£o pode ser desfeito facilmente</strong>. Sempre fa√ßa backup
          antes de usar TRUNCATE em dados importantes!
        </div>

        <hr />

        <h2>BACKUP de Tabela - Criando c√≥pias de seguran√ßa</h2>
        <p>
          Um backup de tabela cria uma c√≥pia completa de uma tabela com todos os
          seus dados. Isso √© √∫til para manter dados hist√≥ricos ou como medida de
          seguran√ßa antes de opera√ß√µes arriscadas.
        </p>

        <h3>Criando uma c√≥pia de backup de uma tabela</h3>
        <pre><code class="language-sql">
-- Sintaxe b√°sica
CREATE TABLE nome_tabela_backup AS
SELECT * FROM nome_tabela;

-- Exemplo 1: Backup da tabela de alunos antes de opera√ß√µes perigosas
CREATE TABLE alunos_backup AS
SELECT * FROM alunos;

-- Exemplo 2: Backup da tabela de matr√≠culas
CREATE TABLE matriculas_backup AS
SELECT * FROM matriculas;

-- Exemplo 3: Backup da tabela de telefones
CREATE TABLE telefones_backup AS
SELECT * FROM telefones;

-- Exemplo 4: Backup com filtro (apenas registros espec√≠ficos)
CREATE TABLE matriculas_2024_backup AS
SELECT * FROM matriculas
WHERE EXTRACT(YEAR FROM data_matricula) = 2024;

-- Verificar o backup
SELECT COUNT(*) FROM alunos_backup;

-- Restaurar dados de um backup (se necess√°rio)
-- Op√ß√£o 1: Copiar dados do backup para a tabela original
INSERT INTO alunos
SELECT * FROM alunos_backup
WHERE id NOT IN (SELECT id FROM alunos);

-- Op√ß√£o 2: Restaurar completamente deletando dados atuais e inserindo do backup
DELETE FROM alunos;
INSERT INTO alunos
SELECT * FROM alunos_backup;
        </code></pre>

        <h3>Boas pr√°ticas para backup de tabela</h3>
        <ul>
          <li>
            Crie backups <strong>antes de opera√ß√µes perigosas</strong> (DELETE
            massivo, TRUNCATE, UPDATE grande)
          </li>
          <li>
            Nomeie os backups de forma clara:
            <code>tabela_backup_YYYYMMDD</code>
          </li>
          <li>
            Crie backups de tabelas cr√≠ticas <strong>regularmente</strong>
          </li>
          <li>Documente o motivo do backup para futuras refer√™ncias</li>
          <li>Limpe backups antigos para economizar espa√ßo em disco</li>
        </ul>

        <pre><code class="language-sql">
-- Exemplo de boas pr√°ticas: Backup com data
CREATE TABLE alunos_backup_20250116 AS
SELECT * FROM alunos;

-- Backup antes de um DELETE grande
CREATE TABLE matriculas_backup_antes_limpeza AS
SELECT * FROM matriculas;

DELETE FROM matriculas WHERE nota < 6;

-- Agora voc√™ pode restaurar se necess√°rio
        </code></pre>

        <hr />

        <h2>Import√¢ncia do BACKUP de Banco de Dados</h2>
        <p>
          Um backup do banco de dados √© uma
          <strong>c√≥pia completa e integral</strong> de todo o banco, incluindo
          todas as tabelas, √≠ndices, constraints, triggers e dados. √â
          fundamental para garantir a seguran√ßa e disponibilidade dos seus
          dados.
        </p>

        <h3>Por que fazer backup do banco de dados?</h3>
        <ul>
          <li>
            <strong>Prote√ß√£o contra perda de dados:</strong> Discos r√≠gidos
            falham, ataques acontecem, erros ocorrem
          </li>
          <li>
            <strong>Recupera√ß√£o de desastres:</strong> Se o banco for corrompido
            ou destru√≠do, voc√™ pode restaurar
          </li>
          <li>
            <strong>Conformidade legal:</strong> Muitas ind√∫strias exigem
            backups regulares por lei
          </li>
          <li>
            <strong>Prote√ß√£o contra ataques:</strong> Ransomware e hackers podem
            deletar ou criptografar dados
          </li>
          <li>
            <strong>Capacidade de reverter mudan√ßas:</strong> Se um erro cr√≠tico
            for cometido, voc√™ pode voltar a um ponto anterior
          </li>
          <li>
            <strong>Migra√ß√£o de dados:</strong> Facilita mover dados entre
            servidores ou ambientes
          </li>
          <li>
            <strong>Testes seguros:</strong> Voc√™ pode usar backups para testar
            sem riscar os dados reais
          </li>
        </ul>

        <h3>Estrat√©gia de backup recomendada</h3>
        <ul>
          <li>
            <strong>Backup di√°rio:</strong> Executar todos os dias para dados
            cr√≠ticos
          </li>
          <li>
            <strong>Backup semanal:</strong> Backup completo do banco uma vez
            por semana
          </li>
          <li>
            <strong>Backup mensalizado:</strong> Armazenar backups completos do
            final de cada m√™s
          </li>
          <li>
            <strong>Armazenamento distribu√≠do:</strong> Guardar backups em
            locais diferentes (n√£o apenas no mesmo servidor)
          </li>
          <li>
            <strong>Testar restaura√ß√£o:</strong> Periodicamente, teste se seus
            backups funcionam realmente
          </li>
        </ul>

        <div class="alert alert-info mt-4" role="alert">
          üí° <strong>Backup no DBeaver:</strong>
          No DBeaver, voc√™ pode fazer backup do banco inteiro clicando com bot√£o
          direito no banco (dentro de "Databases") e selecionando "Backup
          Database". Voc√™ tamb√©m pode agendar backups autom√°ticos nas
          configura√ß√µes do DBeaver.
        </div>

        <p>
          Selecione no DBeaver o banco que deseja fazer backup, clique com o
          bat√£o direito sobre ele, v√° em ferramentas, depois backup:
        </p>

        <div class="image-wrapper">
          <img
            src="./../assets/imagens/caminhodbeaverbckp.png"
            alt="Passo 1 bkp Dbeaver"
          />
        </div>

        <p>Selecione Todos e clique em pr√≥ximo:</p>

        <div class="image-wrapper">
          <img
            src="./../assets/imagens/acao1dbeaverbkp.png"
            alt="Passo 2 bkp DBeaver"
          />
        </div>

        <p>
          Escolha o caminho onde vai ser salvo o arquivo de backup, nomeie o
          backup e clique em iniciar. Quando terminar, feche a janela.
        </p>

        <div class="image-wrapper">
          <img
            src="./../assets/imagens/nomedbeaverbkp.png"
            alt="Passo 3 bkp Dbeaver"
          />
        </div>

        <div class="alert alert-info mt-4" role="alert">
          üí° <strong>Importante</strong>
          Sempre coloque a exten√ß√£o .backup no fim do nome do seu backup.
        </div>

        <br />

        <h3>O custo de n√£o ter backup</h3>
        <p>
          Considere os cen√°rios abaixo e o impacto financeiro de perder dados:
        </p>
        <ul>
          <li>Perda de confian√ßa dos clientes</li>
          <li>Parada de sistemas e servi√ßos</li>
          <li>Custos de recupera√ß√£o de dados (√†s vezes imposs√≠vel)</li>
          <li>Multas por n√£o cumprir regulamenta√ß√µes</li>
          <li>Dano √† reputa√ß√£o da empresa</li>
          <li>Tempo desperdi√ßado reconstruindo dados perdidos</li>
        </ul>

        <div class="alert alert-danger mt-4" role="alert">
          üî¥ <strong>Regra de Ouro:</strong> Um backup que n√£o foi testado n√£o √©
          um backup real. Sempre teste sua capacidade de restaurar um backup!
        </div>

        <hr />

        <h2>Menu</h2>
        <div class="mt-4">
          <a href="./aula9.html" class="btn btn-primary">Pr√≥xima aula ‚Üí</a>
          <a href="./../index.html" class="btn btn-outline-secondary"
            >‚Üê Voltar ao In√≠cio</a
          >
          <a href="./../aulas.html" class="btn btn-outline-secondary"
            >‚Üê Voltar √†s aulas por data</a
          >
        </div>
      </main>
    </div>

    <script src="./../assets/js/sidebar.js"></script>
    <script src="./../assets/js/table-of-contents.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
  </body>
</html>
