<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aula 3 - Linguagens de Banco de Dados (SQL)</title>
    <link rel="icon" type="image/png" href="./../assets/imagens/caderno.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./../assets/css/style.css" />
  </head>
  <body>
    <div class="container">
      <main class="content">
        <h1>Aula 4 - NormalizaÃ§Ã£o de dados</h1>

        <h2>NormalizaÃ§Ã£o de Banco de Dados</h2>

        <p>
          NormalizaÃ§Ã£o Ã© o processo de organizar os dados em um banco de dados
          para reduzir redundÃ¢ncias e melhorar a integridade dos dados.
        </p>

        <blockquote>
          ğŸ’¡ A normalizaÃ§Ã£o foi criada por <strong>Edgar F. Codd</strong> em
          1970, cientista da computaÃ§Ã£o britÃ¢nico que tambÃ©m inventou o modelo
          relacional de banco de dados.
        </blockquote>

        <h3>Tabela NÃƒO Normalizada - Exemplo Ruim âŒ</h3>

        <p>
          Vamos comeÃ§ar criando uma tabela de alunos
          <strong>sem normalizaÃ§Ã£o</strong>, onde colocamos todas as informaÃ§Ãµes
          em uma Ãºnica tabela:
        </p>

        <pre><code class="language-sql">
CREATE TABLE alunos_nao_normalizado (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(100),
    email VARCHAR(100),
    data_nascimento DATE,
    
    -- Dados de endereÃ§o misturados
    rua VARCHAR(100),
    numero VARCHAR(10),
    bairro VARCHAR(50),
    cidade VARCHAR(50),
    estado VARCHAR(2),
    cep VARCHAR(9),
    
    -- MÃºltiplos telefones em colunas separadas
    telefone1 VARCHAR(15),
    telefone2 VARCHAR(15),
    telefone3 VARCHAR(15),
    
    -- MÃºltiplos cursos em uma mesma coluna (pior ainda!)
    cursos TEXT,  -- Ex: "Python, Java, SQL"
    
    -- Notas dos cursos misturadas
    notas TEXT    -- Ex: "8.5, 9.0, 7.5"
);
        </code></pre>

        <h3>Inserindo dados na tabela nÃ£o normalizada:</h3>

        <pre><code class="language-sql">
INSERT INTO alunos_nao_normalizado 
(nome, email, data_nascimento, rua, numero, bairro, cidade, estado, cep, 
 telefone1, telefone2, telefone3, cursos, notas) 
VALUES 
('JoÃ£o Silva', 'joao@email.com', '2000-05-15', 
 'Rua das Flores', '123', 'Centro', 'SÃ£o Paulo', 'SP', '01234-567',
 '11-98888-1111', '11-97777-2222', NULL,
 'Python, Java, SQL', '8.5, 9.0, 7.5'),
 
('Maria Santos', 'maria@email.com', '1999-08-20',
 'Av. Paulista', '1000', 'Bela Vista', 'SÃ£o Paulo', 'SP', '01310-100',
 '11-96666-3333', NULL, NULL,
 'Python, JavaScript', '9.5, 8.0');
        </code></pre>

        <div class="alert alert-danger" role="alert">
          âš ï¸ <strong>Problemas desta tabela:</strong>
          <ul>
            <li>Dados repetidos (cidade, estado aparecem em cada aluno)</li>
            <li>
              DesperdÃ­cio de espaÃ§o (telefone2 e telefone3 Ã s vezes vazios)
            </li>
            <li>
              DifÃ­cil fazer consultas (como buscar alunos do curso "Python"?)
            </li>
            <li>
              DifÃ­cil atualizar (se mudar o nome do curso, precisa alterar em
              todos)
            </li>
            <li>LimitaÃ§Ã£o (e se o aluno tiver 4 telefones?)</li>
          </ul>
        </div>

        <hr />

        <h3>As TrÃªs Formas Normais</h3>

        <p>
          Edgar F. Codd definiu as formas normais para eliminar esses problemas.
          Vamos entender cada uma:
        </p>

        <h3>1Âª Forma Normal (1FN) - Atomicidade</h3>

        <p>
          <strong>Regra:</strong> Cada campo deve conter apenas
          <strong>um valor atÃ´mico</strong> (indivisÃ­vel).
        </p>

        <div class="alert alert-warning" role="alert">
          âŒ <strong>Errado:</strong> cursos = "Python, Java, SQL" (vÃ¡rios
          valores)<br />
          âœ… <strong>Certo:</strong> Uma linha para cada curso do aluno
        </div>

        <h3>2Âª Forma Normal (2FN) - DependÃªncia Total</h3>

        <p>
          <strong>Regra:</strong> Deve estar na 1FN + todos os campos nÃ£o-chave
          devem depender <strong>totalmente</strong> da chave primÃ¡ria.
        </p>

        <div class="alert alert-warning" role="alert">
          âŒ <strong>Errado:</strong> Nome do curso depende do ID do curso, nÃ£o
          do aluno<br />
          âœ… <strong>Certo:</strong> Criar tabela separada para cursos
        </div>

        <h3>3Âª Forma Normal (3FN) - Sem DependÃªncia Transitiva</h3>

        <p>
          <strong>Regra:</strong> Deve estar na 2FN + nenhum campo nÃ£o-chave
          pode depender de outro campo nÃ£o-chave.
        </p>

        <div class="alert alert-warning" role="alert">
          âŒ <strong>Errado:</strong> Cidade depende do CEP (nÃ£o do ID do
          aluno)<br />
          âœ… <strong>Certo:</strong> Criar tabela separada para endereÃ§os
        </div>

        <hr />

        <h3>Tabelas Normalizadas - Exemplo Correto âœ…</h3>

        <p>Agora vamos criar as tabelas seguindo as trÃªs formas normais:</p>

        <h3>1. Tabela de Alunos (dados principais)</h3>

        <pre><code class="language-sql">
CREATE TABLE alunos (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    data_nascimento DATE,
    created_at TIMESTAMP DEFAULT NOW()
);
        </code></pre>

        <h3>2. Tabela de EndereÃ§os</h3>

        <pre><code class="language-sql">
CREATE TABLE enderecos (
    id SERIAL PRIMARY KEY,
    aluno_id INTEGER NOT NULL,
    rua VARCHAR(100) NOT NULL,
    numero VARCHAR(10),
    complemento VARCHAR(50),
    bairro VARCHAR(50) NOT NULL,
    cidade VARCHAR(50) NOT NULL,
    estado VARCHAR(2) NOT NULL,
    cep VARCHAR(9) NOT NULL,
    tipo VARCHAR(20) DEFAULT 'residencial', -- residencial, comercial
    FOREIGN KEY (aluno_id) REFERENCES alunos(id) ON DELETE CASCADE
);
        </code></pre>

        <h3>3. Tabela de Telefones</h3>

        <pre><code class="language-sql">
CREATE TABLE telefones (
    id SERIAL PRIMARY KEY,
    aluno_id INTEGER NOT NULL,
    numero VARCHAR(15) NOT NULL,
    tipo VARCHAR(20) DEFAULT 'celular', -- celular, residencial, comercial
    FOREIGN KEY (aluno_id) REFERENCES alunos(id) ON DELETE CASCADE
);
        </code></pre>

        <h3>4. Tabela de Cursos</h3>

        <pre><code class="language-sql">
CREATE TABLE cursos (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL UNIQUE,
    carga_horaria INTEGER,
    descricao TEXT
);
        </code></pre>

        <h3>5. Tabela de MatrÃ­culas (relacionamento N para N)</h3>

        <pre><code class="language-sql">
CREATE TABLE matriculas (
    id SERIAL PRIMARY KEY,
    aluno_id INTEGER NOT NULL,
    curso_id INTEGER NOT NULL,
    nota DECIMAL(4,2),
    data_matricula DATE DEFAULT CURRENT_DATE,
    status VARCHAR(20) DEFAULT 'cursando', -- cursando, concluido, trancado
    FOREIGN KEY (aluno_id) REFERENCES alunos(id) ON DELETE CASCADE,
    FOREIGN KEY (curso_id) REFERENCES cursos(id) ON DELETE CASCADE,
    UNIQUE(aluno_id, curso_id) -- Um aluno nÃ£o pode se matricular duas vezes no mesmo curso
);
        </code></pre>

        <hr />

        <h3>Inserindo Dados nas Tabelas Normalizadas</h3>

        <h3>Passo 1: Inserir Alunos</h3>

        <pre><code class="language-sql">
INSERT INTO alunos (nome, email, data_nascimento) VALUES
('JoÃ£o Silva', 'joao@email.com', '2000-05-15'),
('Maria Santos', 'maria@email.com', '1999-08-20'),
('Pedro Oliveira', 'pedro@email.com', '2001-03-10');
        </code></pre>

        <h3>Passo 2: Inserir EndereÃ§os</h3>

        <pre><code class="language-sql">
INSERT INTO enderecos (aluno_id, rua, numero, bairro, cidade, estado, cep) VALUES
(1, 'Rua das Flores', '123', 'Centro', 'SÃ£o Paulo', 'SP', '01234-567'),
(2, 'Av. Paulista', '1000', 'Bela Vista', 'SÃ£o Paulo', 'SP', '01310-100'),
(3, 'Rua Augusta', '500', 'ConsolaÃ§Ã£o', 'SÃ£o Paulo', 'SP', '01305-000');
        </code></pre>

        <h3>Passo 3: Inserir Telefones</h3>

        <pre><code class="language-sql">
INSERT INTO telefones (aluno_id, numero, tipo) VALUES
(1, '11-98888-1111', 'celular'),
(1, '11-97777-2222', 'residencial'),
(2, '11-96666-3333', 'celular'),
(3, '11-95555-4444', 'celular'),
(3, '11-3333-5555', 'comercial');
        </code></pre>

        <h3>Passo 4: Inserir Cursos</h3>

        <pre><code class="language-sql">
INSERT INTO cursos (nome, carga_horaria, descricao) VALUES
('Python BÃ¡sico', 40, 'IntroduÃ§Ã£o Ã  programaÃ§Ã£o com Python'),
('Java AvanÃ§ado', 60, 'ProgramaÃ§Ã£o orientada a objetos com Java'),
('SQL Essencial', 30, 'Fundamentos de banco de dados relacionais'),
('JavaScript Moderno', 50, 'Desenvolvimento web com JavaScript ES6+');
        </code></pre>

        <h3>Passo 5: Fazer MatrÃ­culas</h3>

        <pre><code class="language-sql">
INSERT INTO matriculas (aluno_id, curso_id, nota, status) VALUES
(1, 1, 8.5, 'concluido'),  -- JoÃ£o em Python
(1, 2, 9.0, 'concluido'),  -- JoÃ£o em Java
(1, 3, 7.5, 'cursando'),   -- JoÃ£o em SQL
(2, 1, 9.5, 'concluido'),  -- Maria em Python
(2, 4, 8.0, 'cursando'),   -- Maria em JavaScript
(3, 3, NULL, 'cursando');  -- Pedro em SQL (sem nota ainda)
        </code></pre>

        <hr />

        <h3>Consultando os Dados Normalizados</h3>

        <h3>Ver todos os dados de um aluno (JOIN):</h3>

        <pre><code class="language-sql">
-- Dados completos do JoÃ£o
SELECT 
    a.nome,
    a.email,
    e.rua,
    e.cidade,
    e.estado,
    t.numero as telefone,
    t.tipo as tipo_telefone
FROM alunos a
LEFT JOIN enderecos e ON a.id = e.aluno_id
LEFT JOIN telefones t ON a.id = t.aluno_id
WHERE a.nome = 'JoÃ£o Silva';
        </code></pre>

        <h3>Ver cursos de um aluno com notas:</h3>

        <pre><code class="language-sql">
SELECT 
    a.nome as aluno,
    c.nome as curso,
    m.nota,
    m.status
FROM alunos a
JOIN matriculas m ON a.id = m.aluno_id
JOIN cursos c ON m.curso_id = c.id
WHERE a.nome = 'JoÃ£o Silva';
        </code></pre>

        <h3>Ver todos os alunos de um curso:</h3>

        <pre><code class="language-sql">
SELECT 
    c.nome as curso,
    a.nome as aluno,
    m.nota,
    m.status
FROM cursos c
JOIN matriculas m ON c.id = m.curso_id
JOIN alunos a ON m.aluno_id = a.id
WHERE c.nome = 'Python BÃ¡sico';
        </code></pre>

        <hr />

        <h3>Vantagens da NormalizaÃ§Ã£o</h3>

        <div class="alert alert-success" role="alert">
          <strong>âœ… BenefÃ­cios:</strong>
          <ul>
            <li><strong>Menos redundÃ¢ncia:</strong> Dados nÃ£o se repetem</li>
            <li>
              <strong>Integridade:</strong> AlteraÃ§Ãµes sÃ£o feitas em um sÃ³ lugar
            </li>
            <li>
              <strong>Flexibilidade:</strong> FÃ¡cil adicionar novos telefones,
              cursos, etc.
            </li>
            <li>
              <strong>Consultas poderosas:</strong> JOINs permitem combinar
              dados de vÃ¡rias formas
            </li>
            <li>
              <strong>ManutenÃ§Ã£o:</strong> Mais fÃ¡cil atualizar e corrigir dados
            </li>
          </ul>
        </div>

        <h3>Diagrama de Relacionamentos</h3>

        <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ALUNOS    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚â”€â”€â”€â”
â”‚ nome        â”‚   â”‚
â”‚ email       â”‚   â”‚
â”‚ data_nasc   â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         â”‚         â”‚             â”‚
        â–¼         â–¼         â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ENDEREÃ‡OS  â”‚ â”‚TELEFONES â”‚  â”‚   MATRÃCULAS    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚ â”‚ id (PK)  â”‚  â”‚ id (PK)         â”‚
â”‚ aluno_id(FK)â”‚ â”‚aluno_id  â”‚  â”‚ aluno_id (FK)   â”‚
â”‚ rua         â”‚ â”‚  (FK)    â”‚  â”‚ curso_id (FK)   â”‚
â”‚ cidade      â”‚ â”‚ numero   â”‚  â”‚ nota            â”‚
â”‚ estado      â”‚ â”‚ tipo     â”‚  â”‚ status          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚
                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   CURSOS    â”‚
                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                              â”‚ id (PK)     â”‚
                              â”‚ nome        â”‚
                              â”‚ carga_hor.  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </pre>

        <blockquote>
          ğŸ’¡ <strong>Dica Final:</strong> A normalizaÃ§Ã£o nem sempre precisa
          chegar atÃ© a 3FN. Em alguns casos, um pouco de redundÃ¢ncia pode
          melhorar a performance. Isso se chama
          <strong>desnormalizaÃ§Ã£o controlada</strong>, mas sÃ³ faÃ§a isso depois
          de dominar a normalizaÃ§Ã£o!
        </blockquote>

        <h2>Menu</h2>
        <div class="mt-4">
          <a href="./../index.html" class="btn btn-outline-secondary"
            >â† Voltar ao InÃ­cio</a
          >
          <a href="./../aulas.html" class="btn btn-outline-secondary"
            >â† Voltar Ã s aulas por data</a
          >
        </div>

        <h2>Menu</h2>
        <div class="mt-4">
          <!-- <a href="./aula2.html" class="btn btn-primary">PrÃ³xima aula â†’</a> -->
          <a href="./../index.html" class="btn btn-outline-secondary"
            >â† Voltar ao InÃ­cio</a
          >
          <a href="./../aulas.html" class="btn btn-outline-secondary"
            >â† Voltar Ã s aulas por data</a
          >
        </div>
      </main>
    </div>

    <script src="./../assets/js/sidebar.js"></script>
    <script src="./../assets/js/table-of-contents.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
  </body>
</html>
